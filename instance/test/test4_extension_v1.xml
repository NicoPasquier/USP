<?xml version="1.0"?>
<!-- 
<calendar>
    <startingYear>2023</startingYear>
    <weeks>1-34</weeks>
    <weekDays>1-5</weekDays>
</calendar>
 -->
<timetabling xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="usp_timetabling_v1_2.xsd" name="test" nrWeeks="3" nrDaysPerWeek="5" nrSlotsPerDay="1440">

    <rooms>
        <room id="room-1" capacity="50" label=""/>
    </rooms>

    <teachers>
        <teacher label="" id="teacher-1"/>
    </teachers>

    <courses>
        <course id="course-1" label="">
            <part id="course-1-CM" nrSessions="2" label="CM">
                <classes maxHeadCount="80">
                    <class id="course-1-CM-1"><sessions>1,2</sessions></class>
                </classes>
                <allowedSlots sessionLength="180">
                    <dailySlots>540,840</dailySlots>
                    <days>1-5</days>
                    <weeks>1-2</weeks>
                </allowedSlots>
                <allowedRooms sessionRooms="single">
                    <room refId="room-1"/>
                </allowedRooms>
                <allowedTeachers sessionTeachers="1">
                    <teacher refId="teacher-1" nrSessions="2"/>
                </allowedTeachers>
            </part>
            <part id="course-1-TD" nrSessions="1" label="TD">
                <classes maxHeadCount="80">
                    <class id="course-1-TD-1"><sessions>3</sessions></class>
                </classes>
                <allowedSlots sessionLength="180">
                    <dailySlots>540,840</dailySlots>
                    <days>1-5</days>
                    <weeks>1-2</weeks>
                </allowedSlots>
                <allowedRooms sessionRooms="single">
                    <room refId="room-1"/>
                </allowedRooms>
                <allowedTeachers sessionTeachers="1">
                    <teacher refId="teacher-1" nrSessions="1"/>
                </allowedTeachers>
            </part>
        </course>
    </courses>

    <students>
        <student id="student-1" label="">
            <courses>
                <course refId="course-1"/>
            </courses>
        </student>
    </students>

    <rules>
        <!-- sÃ©ances CTD 1-11 en semaines 1-5 -->
        <rule number="1">
            <selector generator="(student, *)" filters=""/>
            <constraint name="noOverlap" type="hard">
            </constraint>
        </rule>

        <!-- conditionnel-->
        <rule number="2">
            <selector generator="(lecturer, *)" filters=""/>
            <constraint name="noOverlap" type="hard">
            </constraint>
        </rule>

        <!-- conditionnel-->
        <rule number="3">
            <selector generator="(room, *)" filters=""/>
            <constraint name="noOverlap" type="hard">
            </constraint>
        </rule>

        <!-- impliciteSequenced-->
        <rule number="4">
            <selector generator="(class, *)" filters=""/>
            <constraint name="sequenced" type="hard">
            </constraint>
        </rule>

        <!-- service of teacher by part-->
        <rule number="5">
            <selector generator="(part, *)" filters=""/>
            <constraint name="teacherService" type="hard">
            </constraint>
        </rule>
        <rule number="6">
            <selector generator="(class,{2})" filters="part[id='course-1-CM']"/>
            <selector generator="(class,{1})" filters="part[id='course-1-TD']"/>
            <constraint name="sequenced" type="hard"/>
        </rule>
    </rules>

    <constraints><constraint rule="1" arity="1" name="noOverlap" type="hard">
<emaps>
<emap type="student" refId="student-1">1,2,3
</emap></emaps></constraint><constraint rule="2" arity="1" name="noOverlap" type="hard">
<emaps>
<emap type="lecturer" refId="teacher-1">1,2,3
</emap></emaps></constraint><constraint rule="3" arity="1" name="noOverlap" type="hard">
<emaps>
<emap type="room" refId="room-1">1,2,3
</emap></emaps></constraint><constraint rule="4" arity="1" name="sequenced" type="hard">
<emaps>
<emap type="class" refId="course-1-CM-1">1,2
</emap></emaps></constraint><constraint rule="4" arity="1" name="sequenced" type="hard">
<emaps>
<emap type="class" refId="course-1-TD-1">3
</emap></emaps></constraint><constraint rule="5" arity="1" name="teacherService" type="hard">
<emaps>
<emap type="part" refId="course-1-CM">1,2
</emap></emaps></constraint><constraint rule="5" arity="1" name="teacherService" type="hard">
<emaps>
<emap type="part" refId="course-1-TD">3
</emap></emaps></constraint><constraint rule="6" arity="2" name="sequenced" type="hard">
<emaps>
<emap type="class" refId="course-1-CM-1">2
</emap><emap type="class" refId="course-1-TD-1">3
</emap></emaps></constraint></constraints><solution>
        <groups>
            <group id="group-1" headCount="1">
                <students>
                    <student refId="student-1"/>
                </students>
                <classes>
                    <class refId="course-1-CM-1"/>
                    <class refId="course-1-TD-1"/>
                </classes>
            </group>
        </groups>

        <sessions>
            <session rank="0" class="course-1-CM-1">
                <startingSlot dailySlot="540" day="1" week="1"/>
                <rooms>
                    <room refId="room-1"/>
                </rooms>
                <teachers>
                    <teacher refId="teacher-1"/>
                </teachers>
            </session>
            <session rank="1" class="course-1-CM-1">
                <startingSlot dailySlot="840" day="1" week="1"/>
                <rooms>
                    <room refId="room-1"/>
                </rooms>
                <teachers>
                    <teacher refId="teacher-1"/>
                </teachers>
            </session>
            <session rank="0" class="course-1-TD-1">
                <startingSlot dailySlot="540" day="2" week="1"/>
                <rooms>
                    <room refId="room-1"/>
                </rooms>
                <teachers>
                    <teacher refId="teacher-1"/>
                </teachers>
            </session>
        </sessions>
    </solution>

</timetabling>
